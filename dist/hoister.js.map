{"version":3,"sources":["../node_modules/babel-traverse/lib/path/lib/hoister.js"],"names":["exports","_getIterator2","require","_getIterator3","_interopRequireDefault","_classCallCheck2","_classCallCheck3","_babelTypes","t","_interopRequireWildcard","obj","newObj","Object","default","referenceVisitor","ReferencedIdentifier","path","scope","state","binding","PathHoister","targetScope","_iterator","_isArray","Array","_i","_ref","violationPath","scopes","node","attachTo","uid","declarator","insertFn","parent","module"],"mappings":"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","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _getIterator2 = require(\"babel-runtime/core-js/get-iterator\");\n\nvar _getIterator3 = _interopRequireDefault(_getIterator2);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar referenceVisitor = {\n  ReferencedIdentifier: function ReferencedIdentifier(path, state) {\n    if (path.isJSXIdentifier() && _babelTypes.react.isCompatTag(path.node.name) && !path.parentPath.isJSXMemberExpression()) {\n      return;\n    }\n\n    if (path.node.name === \"this\") {\n      var scope = path.scope;\n      do {\n        if (scope.path.isFunction() && !scope.path.isArrowFunctionExpression()) break;\n      } while (scope = scope.parent);\n      if (scope) state.breakOnScopePaths.push(scope.path);\n    }\n\n    var binding = path.scope.getBinding(path.node.name);\n    if (!binding) return;\n\n    if (binding !== state.scope.getBinding(path.node.name)) return;\n\n    state.bindings[path.node.name] = binding;\n  }\n};\n\nvar PathHoister = function () {\n  function PathHoister(path, scope) {\n    (0, _classCallCheck3.default)(this, PathHoister);\n\n    this.breakOnScopePaths = [];\n\n    this.bindings = {};\n\n    this.scopes = [];\n\n    this.scope = scope;\n    this.path = path;\n\n    this.attachAfter = false;\n  }\n\n  PathHoister.prototype.isCompatibleScope = function isCompatibleScope(scope) {\n    for (var key in this.bindings) {\n      var binding = this.bindings[key];\n      if (!scope.bindingIdentifierEquals(key, binding.identifier)) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  PathHoister.prototype.getCompatibleScopes = function getCompatibleScopes() {\n    var scope = this.path.scope;\n    do {\n      if (this.isCompatibleScope(scope)) {\n        this.scopes.push(scope);\n      } else {\n        break;\n      }\n\n      if (this.breakOnScopePaths.indexOf(scope.path) >= 0) {\n        break;\n      }\n    } while (scope = scope.parent);\n  };\n\n  PathHoister.prototype.getAttachmentPath = function getAttachmentPath() {\n    var path = this._getAttachmentPath();\n    if (!path) return;\n\n    var targetScope = path.scope;\n\n    if (targetScope.path === path) {\n      targetScope = path.scope.parent;\n    }\n\n    if (targetScope.path.isProgram() || targetScope.path.isFunction()) {\n      for (var name in this.bindings) {\n        if (!targetScope.hasOwnBinding(name)) continue;\n\n        var binding = this.bindings[name];\n\n        if (binding.kind === \"param\") continue;\n\n        if (this.getAttachmentParentForPath(binding.path).key > path.key) {\n          this.attachAfter = true;\n          path = binding.path;\n\n          for (var _iterator = binding.constantViolations, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : (0, _getIterator3.default)(_iterator);;) {\n            var _ref;\n\n            if (_isArray) {\n              if (_i >= _iterator.length) break;\n              _ref = _iterator[_i++];\n            } else {\n              _i = _iterator.next();\n              if (_i.done) break;\n              _ref = _i.value;\n            }\n\n            var violationPath = _ref;\n\n            if (this.getAttachmentParentForPath(violationPath).key > path.key) {\n              path = violationPath;\n            }\n          }\n        }\n      }\n    }\n\n    if (path.parentPath.isExportDeclaration()) {\n      path = path.parentPath;\n    }\n\n    return path;\n  };\n\n  PathHoister.prototype._getAttachmentPath = function _getAttachmentPath() {\n    var scopes = this.scopes;\n\n    var scope = scopes.pop();\n\n    if (!scope) return;\n\n    if (scope.path.isFunction()) {\n      if (this.hasOwnParamBindings(scope)) {\n        if (this.scope === scope) return;\n\n        return scope.path.get(\"body\").get(\"body\")[0];\n      } else {\n        return this.getNextScopeAttachmentParent();\n      }\n    } else if (scope.path.isProgram()) {\n      return this.getNextScopeAttachmentParent();\n    }\n  };\n\n  PathHoister.prototype.getNextScopeAttachmentParent = function getNextScopeAttachmentParent() {\n    var scope = this.scopes.pop();\n    if (scope) return this.getAttachmentParentForPath(scope.path);\n  };\n\n  PathHoister.prototype.getAttachmentParentForPath = function getAttachmentParentForPath(path) {\n    do {\n      if (!path.parentPath || Array.isArray(path.container) && path.isStatement() || path.isVariableDeclarator() && path.parentPath.node !== null && path.parentPath.node.declarations.length > 1) return path;\n    } while (path = path.parentPath);\n  };\n\n  PathHoister.prototype.hasOwnParamBindings = function hasOwnParamBindings(scope) {\n    for (var name in this.bindings) {\n      if (!scope.hasOwnBinding(name)) continue;\n\n      var binding = this.bindings[name];\n\n      if (binding.kind === \"param\" && binding.constant) return true;\n    }\n    return false;\n  };\n\n  PathHoister.prototype.run = function run() {\n    var node = this.path.node;\n    if (node._hoisted) return;\n    node._hoisted = true;\n\n    this.path.traverse(referenceVisitor, this);\n\n    this.getCompatibleScopes();\n\n    var attachTo = this.getAttachmentPath();\n    if (!attachTo) return;\n\n    if (attachTo.getFunctionParent() === this.path.getFunctionParent()) return;\n\n    var uid = attachTo.scope.generateUidIdentifier(\"ref\");\n    var declarator = t.variableDeclarator(uid, this.path.node);\n\n    var insertFn = this.attachAfter ? \"insertAfter\" : \"insertBefore\";\n    attachTo[insertFn]([attachTo.isVariableDeclarator() ? declarator : t.variableDeclaration(\"var\", [declarator])]);\n\n    var parent = this.path.parentPath;\n    if (parent.isJSXElement() && this.path.container === parent.node.children) {\n      uid = t.JSXExpressionContainer(uid);\n    }\n\n    this.path.replaceWith(uid);\n  };\n\n  return PathHoister;\n}();\n\nexports.default = PathHoister;\nmodule.exports = exports[\"default\"];"],"file":"hoister.js"}