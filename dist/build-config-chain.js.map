{"version":3,"sources":["../node_modules/babel-core/lib/transformation/file/options/build-config-chain.js"],"names":["exports","_assign","require","_assign2","_interopRequireDefault","_classCallCheck2","_classCallCheck3","_resolve","_resolve2","_json","_json2","_pathIsAbsolute","_pathIsAbsolute2","_path","_path2","_fs","_fs2","obj","default","existsCache","jsonCache","BABELIGNORE_FILENAME","BABELRC_FILENAME","PACKAGE_FILENAME","cached","opts","arguments","log","filename","builder","options","alias","dirname","ConfigChainBuilder","loc","process","foundConfig","foundIgnore","configLoc","exists","pkgLoc","ignoreLoc","file","lines","line","ignore","json","content","err","_ref","extendsLoc","envOpts","envKey","module"],"mappings":"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","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _assign = require(\"babel-runtime/core-js/object/assign\");\n\nvar _assign2 = _interopRequireDefault(_assign);\n\nvar _classCallCheck2 = require(\"babel-runtime/helpers/classCallCheck\");\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nexports.default = buildConfigChain;\n\nvar _resolve = require(\"../../../helpers/resolve\");\n\nvar _resolve2 = _interopRequireDefault(_resolve);\n\nvar _json = require(\"json5\");\n\nvar _json2 = _interopRequireDefault(_json);\n\nvar _pathIsAbsolute = require(\"path-is-absolute\");\n\nvar _pathIsAbsolute2 = _interopRequireDefault(_pathIsAbsolute);\n\nvar _path = require(\"path\");\n\nvar _path2 = _interopRequireDefault(_path);\n\nvar _fs = require(\"fs\");\n\nvar _fs2 = _interopRequireDefault(_fs);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar existsCache = {};\nvar jsonCache = {};\n\nvar BABELIGNORE_FILENAME = \".babelignore\";\nvar BABELRC_FILENAME = \".babelrc\";\nvar PACKAGE_FILENAME = \"package.json\";\n\nfunction exists(filename) {\n  var cached = existsCache[filename];\n  if (cached == null) {\n    return existsCache[filename] = _fs2.default.existsSync(filename);\n  } else {\n    return cached;\n  }\n}\n\nfunction buildConfigChain() {\n  var opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var log = arguments[1];\n\n  var filename = opts.filename;\n  var builder = new ConfigChainBuilder(log);\n\n  if (opts.babelrc !== false) {\n    builder.findConfigs(filename);\n  }\n\n  builder.mergeConfig({\n    options: opts,\n    alias: \"base\",\n    dirname: filename && _path2.default.dirname(filename)\n  });\n\n  return builder.configs;\n}\n\nvar ConfigChainBuilder = function () {\n  function ConfigChainBuilder(log) {\n    (0, _classCallCheck3.default)(this, ConfigChainBuilder);\n\n    this.resolvedConfigs = [];\n    this.configs = [];\n    this.log = log;\n  }\n\n  ConfigChainBuilder.prototype.findConfigs = function findConfigs(loc) {\n    if (!loc) return;\n\n    if (!(0, _pathIsAbsolute2.default)(loc)) {\n      loc = _path2.default.join(process.cwd(), loc);\n    }\n\n    var foundConfig = false;\n    var foundIgnore = false;\n\n    while (loc !== (loc = _path2.default.dirname(loc))) {\n      if (!foundConfig) {\n        var configLoc = _path2.default.join(loc, BABELRC_FILENAME);\n        if (exists(configLoc)) {\n          this.addConfig(configLoc);\n          foundConfig = true;\n        }\n\n        var pkgLoc = _path2.default.join(loc, PACKAGE_FILENAME);\n        if (!foundConfig && exists(pkgLoc)) {\n          foundConfig = this.addConfig(pkgLoc, \"babel\", JSON);\n        }\n      }\n\n      if (!foundIgnore) {\n        var ignoreLoc = _path2.default.join(loc, BABELIGNORE_FILENAME);\n        if (exists(ignoreLoc)) {\n          this.addIgnoreConfig(ignoreLoc);\n          foundIgnore = true;\n        }\n      }\n\n      if (foundIgnore && foundConfig) return;\n    }\n  };\n\n  ConfigChainBuilder.prototype.addIgnoreConfig = function addIgnoreConfig(loc) {\n    var file = _fs2.default.readFileSync(loc, \"utf8\");\n    var lines = file.split(\"\\n\");\n\n    lines = lines.map(function (line) {\n      return line.replace(/#(.*?)$/, \"\").trim();\n    }).filter(function (line) {\n      return !!line;\n    });\n\n    if (lines.length) {\n      this.mergeConfig({\n        options: { ignore: lines },\n        alias: loc,\n        dirname: _path2.default.dirname(loc)\n      });\n    }\n  };\n\n  ConfigChainBuilder.prototype.addConfig = function addConfig(loc, key) {\n    var json = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : _json2.default;\n\n    if (this.resolvedConfigs.indexOf(loc) >= 0) {\n      return false;\n    }\n\n    this.resolvedConfigs.push(loc);\n\n    var content = _fs2.default.readFileSync(loc, \"utf8\");\n    var options = void 0;\n\n    try {\n      options = jsonCache[content] = jsonCache[content] || json.parse(content);\n      if (key) options = options[key];\n    } catch (err) {\n      err.message = loc + \": Error while parsing JSON - \" + err.message;\n      throw err;\n    }\n\n    this.mergeConfig({\n      options: options,\n      alias: loc,\n      dirname: _path2.default.dirname(loc)\n    });\n\n    return !!options;\n  };\n\n  ConfigChainBuilder.prototype.mergeConfig = function mergeConfig(_ref) {\n    var options = _ref.options,\n        alias = _ref.alias,\n        loc = _ref.loc,\n        dirname = _ref.dirname;\n\n    if (!options) {\n      return false;\n    }\n\n    options = (0, _assign2.default)({}, options);\n\n    dirname = dirname || process.cwd();\n    loc = loc || alias;\n\n    if (options.extends) {\n      var extendsLoc = (0, _resolve2.default)(options.extends, dirname);\n      if (extendsLoc) {\n        this.addConfig(extendsLoc);\n      } else {\n        if (this.log) this.log.error(\"Couldn't resolve extends clause of \" + options.extends + \" in \" + alias);\n      }\n      delete options.extends;\n    }\n\n    this.configs.push({\n      options: options,\n      alias: alias,\n      loc: loc,\n      dirname: dirname\n    });\n\n    var envOpts = void 0;\n    var envKey = process.env.BABEL_ENV || process.env.NODE_ENV || \"development\";\n    if (options.env) {\n      envOpts = options.env[envKey];\n      delete options.env;\n    }\n\n    this.mergeConfig({\n      options: envOpts,\n      alias: alias + \".env.\" + envKey,\n      dirname: dirname\n    });\n  };\n\n  return ConfigChainBuilder;\n}();\n\nmodule.exports = exports[\"default\"];"],"file":"build-config-chain.js"}