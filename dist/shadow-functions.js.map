{"version":3,"sources":["../node_modules/babel-core/lib/transformation/internal-plugins/shadow-functions.js"],"names":["exports","_symbol","require","_symbol2","_interopRequireDefault","_plugin","_plugin2","_babelTypes","t","_interopRequireWildcard","obj","newObj","Object","default","SUPER_THIS_BOUND","superVisitor","CallExpression","path","node","name","visitor","ThisExpression","remap","ReferencedIdentifier","shadowPath","shouldShadow","shadowFunction","currentFunction","passedShadowFunction","fnPath","innerPath","p","cached","id","classPath","hasSuperClass","kind","init","key","module"],"mappings":"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","sourcesContent":["\"use strict\";\n\nexports.__esModule = true;\n\nvar _symbol = require(\"babel-runtime/core-js/symbol\");\n\nvar _symbol2 = _interopRequireDefault(_symbol);\n\nvar _plugin = require(\"../plugin\");\n\nvar _plugin2 = _interopRequireDefault(_plugin);\n\nvar _babelTypes = require(\"babel-types\");\n\nvar t = _interopRequireWildcard(_babelTypes);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar SUPER_THIS_BOUND = (0, _symbol2.default)(\"super this bound\");\n\nvar superVisitor = {\n  CallExpression: function CallExpression(path) {\n    if (!path.get(\"callee\").isSuper()) return;\n\n    var node = path.node;\n\n    if (node[SUPER_THIS_BOUND]) return;\n    node[SUPER_THIS_BOUND] = true;\n\n    path.replaceWith(t.assignmentExpression(\"=\", this.id, node));\n  }\n};\n\nexports.default = new _plugin2.default({\n  name: \"internal.shadowFunctions\",\n\n  visitor: {\n    ThisExpression: function ThisExpression(path) {\n      remap(path, \"this\");\n    },\n    ReferencedIdentifier: function ReferencedIdentifier(path) {\n      if (path.node.name === \"arguments\") {\n        remap(path, \"arguments\");\n      }\n    }\n  }\n});\n\n\nfunction shouldShadow(path, shadowPath) {\n  if (path.is(\"_forceShadow\")) {\n    return true;\n  } else {\n    return shadowPath;\n  }\n}\n\nfunction remap(path, key) {\n  var shadowPath = path.inShadow(key);\n  if (!shouldShadow(path, shadowPath)) return;\n\n  var shadowFunction = path.node._shadowedFunctionLiteral;\n\n  var currentFunction = void 0;\n  var passedShadowFunction = false;\n\n  var fnPath = path.find(function (innerPath) {\n    if (innerPath.parentPath && innerPath.parentPath.isClassProperty() && innerPath.key === \"value\") {\n      return true;\n    }\n    if (path === innerPath) return false;\n    if (innerPath.isProgram() || innerPath.isFunction()) {\n      currentFunction = currentFunction || innerPath;\n    }\n\n    if (innerPath.isProgram()) {\n      passedShadowFunction = true;\n\n      return true;\n    } else if (innerPath.isFunction() && !innerPath.isArrowFunctionExpression()) {\n      if (shadowFunction) {\n        if (innerPath === shadowFunction || innerPath.node === shadowFunction.node) return true;\n      } else {\n        if (!innerPath.is(\"shadow\")) return true;\n      }\n\n      passedShadowFunction = true;\n      return false;\n    }\n\n    return false;\n  });\n\n  if (shadowFunction && fnPath.isProgram() && !shadowFunction.isProgram()) {\n    fnPath = path.findParent(function (p) {\n      return p.isProgram() || p.isFunction();\n    });\n  }\n\n  if (fnPath === currentFunction) return;\n\n  if (!passedShadowFunction) return;\n\n  var cached = fnPath.getData(key);\n  if (!cached) {\n    var id = path.scope.generateUidIdentifier(key);\n\n    fnPath.setData(key, id);\n    cached = id;\n\n    var classPath = fnPath.findParent(function (p) {\n      return p.isClass();\n    });\n    var hasSuperClass = !!(classPath && classPath.node && classPath.node.superClass);\n\n    if (key === \"this\" && fnPath.isMethod({ kind: \"constructor\" }) && hasSuperClass) {\n      fnPath.scope.push({ id: id });\n\n      fnPath.traverse(superVisitor, { id: id });\n    } else {\n      var init = key === \"this\" ? t.thisExpression() : t.identifier(key);\n\n      if (shadowFunction) init._shadowedFunctionLiteral = shadowFunction;\n\n      fnPath.scope.push({ id: id, init: init });\n    }\n  }\n\n  var node = t.cloneDeep(cached);\n  node.loc = path.node.loc;\n\n  return path.replaceWith(node);\n}\nmodule.exports = exports[\"default\"];"],"file":"shadow-functions.js"}